<ion-app>
  <app-splash-screen
    *ngIf="showSplash"
    (splashComplete)="hideSplash()">
  </app-splash-screen>

  <ion-router-outlet *ngIf="!showSplash"></ion-router-outlet>

  <!-- PWA Install Banner (optionnel - entreprise) -->
  <div class="pwa-install-banner" *ngIf="showInstallBanner && !showSplash && !showForceInstallModal">
    <div class="banner-content">
      <ion-icon name="download-outline" class="banner-icon"></ion-icon>
      <div class="banner-text">
        <strong>Installer Lako</strong>
        <span>Accedez rapidement a l'application</span>
      </div>
    </div>
    <div class="banner-actions">
      <ion-button fill="solid" color="light" size="small" (click)="installPwa()">
        Installer
      </ion-button>
      <ion-button fill="clear" color="light" size="small" (click)="dismissInstallBanner()">
        <ion-icon name="close-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </div>
  </div>

  <!-- Modal bloquant installation PWA (conducteurs uniquement) -->
  <div class="pwa-force-install-overlay" *ngIf="showForceInstallModal && !showSplash">
    <div class="pwa-force-install-modal">
      <div class="modal-header">
        <img src="assets/icons/icon-128.webp" alt="Lako" class="app-icon">
        <h2>Installation requise</h2>
      </div>

      <div class="modal-body">
        <p>Pour utiliser Lako Chauffeur, vous devez installer l'application sur votre appareil.</p>

        <!-- Instructions Android/Chrome -->
        <div class="install-instructions" *ngIf="!pwaService.isIOS()">
          <ion-button expand="block" (click)="forceInstallPwa()" class="install-btn">
            <ion-icon name="download-outline" slot="start"></ion-icon>
            Installer l'application
          </ion-button>
        </div>

        <!-- Instructions iOS -->
        <div class="install-instructions ios" *ngIf="pwaService.isIOS()">
          <p class="ios-title">Sur iOS, suivez ces etapes :</p>
          <div class="ios-steps">
            <div class="step">
              <span class="step-number">1</span>
              <span>Appuyez sur</span>
              <ion-icon name="share-outline" class="share-icon"></ion-icon>
              <span>(Partager)</span>
            </div>
            <div class="step">
              <span class="step-number">2</span>
              <span>Selectionnez</span>
              <ion-icon name="add-outline" class="add-icon"></ion-icon>
              <span>"Sur l'ecran d'accueil"</span>
            </div>
            <div class="step">
              <span class="step-number">3</span>
              <span>Appuyez sur "Ajouter"</span>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <p class="footer-note">L'installation est gratuite et ne prend que quelques secondes.</p>
      </div>
    </div>
  </div>

  <!-- Modal notification permission (conducteurs uniquement) -->
  <div class="notification-modal-overlay" *ngIf="showNotificationModal && !showSplash && !showForceInstallModal">
    <div class="notification-modal">
      <div class="modal-header">
        <div class="notification-icon-container">
          <ion-icon name="notifications-outline" class="notification-icon"></ion-icon>
        </div>
        <h2>Activer les notifications</h2>
      </div>

      <div class="modal-body">
        <p>Recevez une alerte instantanee des que vous avez une nouvelle reservation.</p>

        <div class="notification-benefits">
          <div class="benefit">
            <span class="benefit-icon">ðŸš—</span>
            <span>Nouvelles courses en temps reel</span>
          </div>
          <div class="benefit">
            <span class="benefit-icon">ðŸ’°</span>
            <span>Ne manquez plus aucune opportunite</span>
          </div>
          <div class="benefit">
            <span class="benefit-icon">âš¡</span>
            <span>Soyez le premier a accepter</span>
          </div>
        </div>

        <div class="notification-actions">
          <ion-button expand="block" (click)="requestNotificationPermission()" class="enable-btn">
            <ion-icon name="notifications-outline" slot="start"></ion-icon>
            Activer les notifications
          </ion-button>
          <ion-button expand="block" fill="clear" (click)="dismissNotificationModal()" class="later-btn">
            Plus tard
          </ion-button>
        </div>
      </div>
    </div>
  </div>
</ion-app>