<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>
      <div class="header-title">
        <ion-icon name="person-circle-outline" class="header-icon"></ion-icon>
        <span>Profile</span>
      </div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">
        <div class="header-title">
          <ion-icon name="person-circle-outline" class="header-icon"></ion-icon>
          <span>Profile</span>
        </div>
      </ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="content-container">
    <!-- Profile Header -->
    <ion-card class="profile-header-card">
      <ion-card-content>
        <div class="profile-header">
          <ion-avatar class="profile-avatar">
            <div class="modern-avatar">
              <ion-icon name="person" class="avatar-icon"></ion-icon>
            </div>
          </ion-avatar>
          <div class="profile-info">
            <h2>{{ driver.name }}</h2>
            <div class="rating">
              <ion-icon name="star" color="warning"></ion-icon>
              <span>{{ driver.rating }}</span>
              <span class="rides-count">({{ driver.totalRides }} courses)</span>
            </div>
            <ion-text color="medium">
              <p>Membre depuis {{ driver.memberSince }}</p>
            </ion-text>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Contact Information -->
    <ion-card class="info-card">
      <ion-card-header>
        <ion-card-title>Informations de contact</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item>
            <ion-icon name="id-card" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>ID Conducteur</h3>
              <p>{{ driver.id }}</p>
            </ion-label>
          </ion-item>
          
          <ion-item>
            <ion-icon name="call" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>Téléphone</h3>
              <p>{{ driver.phone }}</p>
            </ion-label>
          </ion-item>
          
          <ion-item>
            <ion-icon name="mail" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>Email</h3>
              <p>{{ driver.email }}</p>
            </ion-label>
          </ion-item>
          
          <ion-item *ngIf="driver.entreprise_nom">
            <ion-icon name="business" slot="start" color="secondary"></ion-icon>
            <ion-label>
              <h3>Entreprise</h3>
              <p>{{ driver.entreprise_nom }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Vehicle Information -->
    <ion-card class="info-card">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="car" slot="start"></ion-icon>
          Véhicule
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item>
            <ion-icon name="speedometer" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>Type</h3>
              <p>{{ getVehicleTypeLabel(driver.vehicle_type) }}</p>
            </ion-label>
          </ion-item>
          
          <ion-item *ngIf="driver.vehicle_marque">
            <ion-icon name="business" slot="start" color="secondary"></ion-icon>
            <ion-label>
              <h3>Marque</h3>
              <p>{{ driver.vehicle_marque }}</p>
            </ion-label>
          </ion-item>
          
          <ion-item *ngIf="driver.vehicle_modele">
            <ion-icon name="car" slot="start" color="tertiary"></ion-icon>
            <ion-label>
              <h3>Modèle</h3>
              <p>{{ driver.vehicle_modele }}</p>
            </ion-label>
          </ion-item>
          
          <ion-item *ngIf="driver.vehicle_couleur">
            <ion-icon name="color-palette" slot="start" color="warning"></ion-icon>
            <ion-label>
              <h3>Couleur</h3>
              <p>{{ driver.vehicle_couleur }}</p>
            </ion-label>
          </ion-item>
          
          <ion-item *ngIf="driver.vehicle_plaque">
            <ion-icon name="id-card" slot="start" color="success"></ion-icon>
            <ion-label>
              <h3>Plaque d'immatriculation</h3>
              <p class="vehicle-plate">{{ driver.vehicle_plaque }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Rayon de recherche -->
    <ion-card class="info-card">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="location" slot="start"></ion-icon>
          Rayon de recherche
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="rayon-container">
          <ion-item>
            <ion-icon name="navigate-circle" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>Distance maximale</h3>
              <p>{{ getCurrentRayonLabel() }}</p>
            </ion-label>
          </ion-item>
          
          <div class="rayon-control">
            <ion-range
              [value]="driver.rayon_km_reservation || 5"
              [min]="1"
              [max]="50"
              [step]="1"
              [pin]="true"
              [ticks]="false"
              color="primary"
              (ionInput)="onRayonChange($event)">
              
              <ion-label slot="start">1km</ion-label>
              <ion-label slot="end">50km</ion-label>
            </ion-range>
            
            <div class="rayon-presets">
              <ion-chip 
                [color]="(driver.rayon_km_reservation || 5) === 5 ? 'primary' : 'medium'"
                (click)="setRayon(5)">
                5km
              </ion-chip>
              <ion-chip 
                [color]="(driver.rayon_km_reservation || 5) === 10 ? 'primary' : 'medium'"
                (click)="setRayon(10)">
                10km
              </ion-chip>
              <ion-chip 
                [color]="(driver.rayon_km_reservation || 5) === 20 ? 'primary' : 'medium'"
                (click)="setRayon(20)">
                20km
              </ion-chip>
              <ion-chip 
                [color]="(driver.rayon_km_reservation || 5) === 50 ? 'primary' : 'medium'"
                (click)="setRayon(50)">
                50km
              </ion-chip>
            </div>
            
            <div class="rayon-info">
              <ion-text color="medium">
                <p>
                  <ion-icon name="information-circle" color="medium"></ion-icon>
                  Vous recevrez les réservations dans un rayon de {{ driver.rayon_km_reservation || 5 }}km autour de votre position
                </p>
              </ion-text>
            </div>
            
            <!-- ✅ NOUVEAU : Bouton Test pour voir toutes les réservations -->
            <div class="test-section">
              <ion-button 
                fill="outline" 
                color="warning" 
                size="small"
                (click)="toggleTestMode()"
                class="test-button">
                <ion-icon name="bug" slot="start"></ion-icon>
                {{ testMode ? 'Désactiver' : 'Activer' }} mode test
              </ion-button>
              <ion-text color="medium" *ngIf="testMode">
                <p><small>⚠️ Mode test activé - toutes les réservations visibles</small></p>
              </ion-text>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Statistics -->
    <ion-card class="stats-card">
      <ion-card-header>
        <ion-card-title>Statistiques</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-number">{{ driver.totalRides }}</div>
            <div class="stat-label">Courses totales</div>
          </div>
          <div class="stat-item">
            <div class="stat-number">{{ driver.rating }}</div>
            <div class="stat-label">Note moyenne</div>
          </div>
          <div class="stat-item">
            <div class="stat-number">{{ driver.memberSince }}</div>
            <div class="stat-label">Année d'inscription</div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Actions -->
    <ion-card class="actions-card">
      <ion-card-content>
        <ion-list>
          <ion-item button (click)="openPasswordModal()">
            <ion-icon name="lock-closed-outline" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>Changer le mot de passe</h3>
            </ion-label>
          </ion-item>

          <ion-item button (click)="onLogout()">
            <ion-icon name="log-out" slot="start" color="danger"></ion-icon>
            <ion-label color="danger">
              <h3>Déconnexion</h3>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Affichage version -->
    <div class="version-info">
      <ion-text color="medium">
        <p>Version {{ appVersion }}</p>
      </ion-text>
    </div>
  </div>

</ion-content>